###################################################################################################
#  Version History
###################################################################################################
#  	Version 	| Date        	         | 	    Author			|	Comments
#  	1.0      	| 16 AUG, 2025 	         | 	    HASSAN HOUTA	|	Initial.
###################################################################################################
# This file is to configure Airflow. The paths are in the Airflow container and is bindâ€‘mounted from the host.
###################################################################################################


[core]
# The folder where your airflow pipelines live
dags_folder = /opt/airflow/dags

# The executor class that airflow should use
executor = LocalExecutor

# The SqlAlchemy connection string to the metadata database
sql_alchemy_conn = postgresql+psycopg2://airflow:airflow@postgres-airflow/airflow

# Whether to load the default connections
load_default_connections = True

# Whether to load the examples
load_examples = False

# Security: Enable Fernet key for encrypted connections
fernet_key =

# Security: Secret key for session management
secret_key =

[webserver]
# The base url of Airflow Dashboard - Use HTTPS for production
base_url = https://localhost:8443

# The ip specified when starting the web server
web_server_host = 0.0.0.0

# The port on which to run the web server
web_server_port = 8443

# Number of seconds the webserver waits before killing gunicorn master that doesn't respond
web_server_master_timeout = 120

# Number of seconds the gunicorn webserver waits before timing out on a worker
web_server_worker_timeout = 120

# Security: Enable HTTPS
web_server_ssl_cert = /opt/airflow/certs/airflow.crt
web_server_ssl_key = /opt/airflow/certs/airflow.key

# Security: Authentication settings
authenticate = True
auth_backend = airflow.auth.backend.basic_auth

# Security: Session timeout (in seconds)
session_timeout = 3600

# Security: Enable CSRF protection
enable_proxy_fix = True
proxy_fix_x_for = 1
proxy_fix_x_proto = 1
proxy_fix_x_host = 1

# Security: Rate limiting
rate_limit = 1000
rate_limit_reset = 3600

# Security: Maximum login attempts
max_login_attempts = 5
login_failure_delay = 60

[scheduler]
# Task instances listen for external kill signal (when you clear tasks from the CLI or the UI)
job_heartbeat_sec = 5

# How often (in seconds) to scan the DAGs directory for new files
dag_dir_list_interval = 300

# How often should stats be printed to the logs
print_stats_interval = 30

# If the last scheduler heartbeat happened more than scheduler_health_check_threshold ago (in seconds),
scheduler_health_check_threshold = 30

# How often (in seconds) to check and tidy up 'running' TaskInstancess that no longer have a matching DagRun
orphaned_tasks_check_interval = 300

[smtp]
# If you want airflow to send emails on retries, failure, and you want to use
# the airflow.utils.email.send_email_smtp function, you have to configure an
smtp_host = localhost
smtp_starttls = True
smtp_ssl = False
smtp_user = airflow
smtp_password = airflow
smtp_port = 25
smtp_mail_from = hassan.houta@outlook.com

[security]
# Security: Enable RBAC (Role-Based Access Control)
rbac = True

# Security: Enable audit logging
audit_log_enabled = True

# Security: Session security
session_cookie_secure = True
session_cookie_httponly = True
session_cookie_samesite = Lax

# Security: Password policy
password_min_length = 12
password_require_uppercase = True
password_require_lowercase = True
password_require_numbers = True
password_require_special = True

[api]
# Security: API authentication
auth_backend = airflow.api.auth.backend.basic_auth

# Security: API rate limiting
rate_limit = 1000
rate_limit_reset = 3600
