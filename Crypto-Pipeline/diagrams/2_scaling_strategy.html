<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scaling Strategy - Crypto Pipeline</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #2196F3;
            padding-bottom: 10px;
        }
        .mermaid {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin: 20px 0;
        }
        .description {
            background-color: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <h1>Scaling Strategy - Horizontal and Vertical</h1>

    <div class="description">
        <h2>Scaling Dimensions</h2>
        <ul>
            <li><strong>Horizontal Scaling:</strong> Add more instances of services</li>
            <li><strong>Vertical Scaling:</strong> Increase resources per instance</li>
            <li><strong>Auto-scaling:</strong> Dynamic resource allocation based on metrics</li>
            <li><strong>Sharding:</strong> Distribute data across multiple databases</li>
        </ul>
    </div>

    <div class="mermaid">
graph TB
    subgraph "Current Scale (Baseline)"
        C1["ðŸ“Š Current Capacity<br/>â€¢ 10 symbols<br/>â€¢ 6 msg/sec<br/>â€¢ 500K msg/day<br/>â€¢ 1 producer<br/>â€¢ 1 consumer<br/>â€¢ Single DB"]
    end

    subgraph "Scaling Triggers"
        T1["ðŸ“ˆ Load Triggers<br/>â€¢ CPU > 70%<br/>â€¢ Memory > 80%<br/>â€¢ Lag > 1000 msg<br/>â€¢ Latency > 500ms"]
        T2["ðŸ“Š Business Triggers<br/>â€¢ Add 50+ symbols<br/>â€¢ 10x volume<br/>â€¢ Sub-second SLA<br/>â€¢ Global expansion"]
    end

    subgraph "Horizontal Scaling - Producers"
        HP1["Producer Pool<br/>â€¢ 3-5 instances<br/>â€¢ Symbol sharding<br/>â€¢ Load balancer<br/>â€¢ Health checks"]
        HP2["Partition Strategy<br/>â€¢ 1 partition/symbol<br/>â€¢ Round-robin<br/>â€¢ Sticky sessions<br/>â€¢ Failover ready"]
    end

    subgraph "Horizontal Scaling - Kafka"
        HK1["Kafka Cluster<br/>â€¢ 3 brokers minimum<br/>â€¢ Replication factor: 2<br/>â€¢ 100+ partitions<br/>â€¢ Rack awareness"]
        HK2["Topic Optimization<br/>â€¢ crypto_prices_v2<br/>â€¢ crypto_orderbook<br/>â€¢ crypto_trades<br/>â€¢ crypto_analytics"]
    end

    subgraph "Horizontal Scaling - Consumers"
        HC1["Consumer Groups<br/>â€¢ 5-10 instances<br/>â€¢ Partition assignment<br/>â€¢ Cooperative rebalancing<br/>â€¢ Offset management"]
        HC2["Specialized Consumers<br/>â€¢ DB Writer (5x)<br/>â€¢ Alert Monitor (3x)<br/>â€¢ Analytics (3x)<br/>â€¢ Archive (2x)"]
    end

    subgraph "Horizontal Scaling - Database"
        HD1["TimescaleDB Cluster<br/>â€¢ Multi-node<br/>â€¢ Data nodes: 3-5<br/>â€¢ Access node: 2<br/>â€¢ Distributed hypertables"]
        HD2["Read Replicas<br/>â€¢ 2-3 replicas<br/>â€¢ Read load balancing<br/>â€¢ Async replication<br/>â€¢ Failover ready"]
    end

    subgraph "Vertical Scaling Options"
        Beltone_V2["Producer Scaling<br/>â€¢ 2 â†’ 4 vCPU<br/>â€¢ 4 â†’ 8 GB RAM<br/>â€¢ Batch size: 100 â†’ 500<br/>â€¢ Compression: snappy"]
        V2["Kafka Scaling<br/>â€¢ 4 â†’ 8 vCPU/broker<br/>â€¢ 8 â†’ 16 GB RAM<br/>â€¢ NVMe SSDs<br/>â€¢ 10 Gbps network"]
        V3["Database Scaling<br/>â€¢ 8 â†’ 32 vCPU<br/>â€¢ 32 â†’ 128 GB RAM<br/>â€¢ io2 SSD: 10K IOPS<br/>â€¢ Connection pool: 200"]
    end

    subgraph "Auto-scaling Policies"
        AS1["Producer Auto-scale<br/>â€¢ Min: 1, Max: 10<br/>â€¢ Target CPU: 60%<br/>â€¢ Scale-out: +2<br/>â€¢ Scale-in: -1"]
        AS2["Consumer Auto-scale<br/>â€¢ Min: 2, Max: 20<br/>â€¢ Target lag: 500<br/>â€¢ Scale-out: +3<br/>â€¢ Cool-down: 5min"]
        AS3["Database Auto-scale<br/>â€¢ Storage: Auto-expand<br/>â€¢ IOPS: Auto-adjust<br/>â€¢ Read replicas: 1-5<br/>â€¢ Based on connections"]
    end

    subgraph "Performance Targets"
        P1["ðŸŽ¯ Target Metrics<br/>â€¢ 100 symbols<br/>â€¢ 100 msg/sec<br/>â€¢ 10M msg/day<br/>â€¢ <50ms latency<br/>â€¢ 99.99% uptime"]
        P2["ðŸ’° Cost Targets<br/>â€¢ <$5K/month<br/>â€¢ Optimize spot instances<br/>â€¢ Reserved capacity<br/>â€¢ Data lifecycle"]
    end

    C1 --> T1
    C1 --> T2

    T1 --> HP1
    T1 --> HK1
    T1 --> HC1
    T1 --> HD1

    T2 --> Beltone_V2
    T2 --> V2
    T2 --> V3

    HP1 --> HP2
    HK1 --> HK2
    HC1 --> HC2
    HD1 --> HD2

    Beltone_V2 --> AS1
    V2 --> AS2
    V3 --> AS3

    AS1 --> P1
    AS2 --> P1
    AS3 --> P1

    P1 --> P2

    style C1 fill:#e3f2fd
    style P1 fill:#c8e6c9
    style P2 fill:#fff9c4
    </div>

    <div class="mermaid">
graph LR
    subgraph "Scaling Timeline"
        M1["Month 1<br/>Baseline<br/>10 symbols"]
        M2["Month 2<br/>+Consumers<br/>25 symbols"]
        M3["Month 3<br/>+Kafka nodes<br/>50 symbols"]
        M4["Month 6<br/>Multi-region<br/>100 symbols"]
        M5["Month 12<br/>Full scale<br/>200+ symbols"]
    end

    M1 -->|"Scale consumers"| M2
    M2 -->|"Scale Kafka"| M3
    M3 -->|"Add regions"| M4
    M4 -->|"Optimize"| M5

    style M1 fill:#bbdefb
    style M2 fill:#c5cae9
    style M3 fill:#d1c4e9
    style M4 fill:#e1bee7
    style M5 fill:#f8bbd0
    </div>

    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            themeVariables: {
                primaryColor: '#2196F3',
                primaryTextColor: '#fff',
                primaryBorderColor: '#1976D2',
                lineColor: '#333',
                secondaryColor: '#4CAF50'
            }
        });
    </script>
</body>
</html>
