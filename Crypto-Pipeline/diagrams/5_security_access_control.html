<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Security and Access Control Layers - Crypto Pipeline</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #F44336;
            padding-bottom: 10px;
        }
        .mermaid {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin: 20px 0;
        }
        .description {
            background-color: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: #F44336;
            color: white;
        }
        .security-critical {
            background-color: #ffebee;
            font-weight: bold;
        }
        .security-high {
            background-color: #fff3e0;
        }
        .security-medium {
            background-color: #f3e5f5;
        }
    </style>
</head>
<body>
    <h1>Security and Access Control Layers</h1>

    <div class="description">
        <h2>Security Framework Overview</h2>
        <p>Multi-layered security architecture implementing defense in depth strategy:</p>
        <ul>
            <li><strong>Network Security:</strong> VPC isolation, security groups, NACLs</li>
            <li><strong>Identity & Access:</strong> RBAC, service accounts, API keys</li>
            <li><strong>Data Security:</strong> Encryption at rest and in transit</li>
            <li><strong>Application Security:</strong> Container scanning, secrets management</li>
            <li><strong>Compliance:</strong> Audit logs, monitoring, alerting</li>
        </ul>
    </div>

    <div class="mermaid">
graph TB
    subgraph "External Layer - Internet Facing"
        EXT_USER["üë§ External Users"]
        EXT_API["üåê Public APIs"]
        EXT_THREAT["üî¥ Threat Actors"]
    end

    subgraph "Perimeter Security"
        WAF["üõ°Ô∏è WAF<br/>‚Ä¢ OWASP Top 10<br/>‚Ä¢ Rate limiting<br/>‚Ä¢ Geo-blocking<br/>‚Ä¢ DDoS protection"]
        CDN["üåç CDN/CloudFlare<br/>‚Ä¢ SSL/TLS termination<br/>‚Ä¢ Bot protection<br/>‚Ä¢ Cache layer"]
        LB["‚öñÔ∏è Load Balancer<br/>‚Ä¢ SSL certificates<br/>‚Ä¢ Health checks<br/>‚Ä¢ Traffic distribution"]
    end

    subgraph "Network Security Layer"
        VPC["üîí VPC<br/>‚Ä¢ Private subnets<br/>‚Ä¢ Public subnets<br/>‚Ä¢ NAT Gateway<br/>‚Ä¢ Internet Gateway"]
        SG["üö™ Security Groups<br/>‚Ä¢ Stateful firewall<br/>‚Ä¢ Port restrictions<br/>‚Ä¢ Source IP filtering"]
        NACL["üìã Network ACLs<br/>‚Ä¢ Stateless firewall<br/>‚Ä¢ Subnet level<br/>‚Ä¢ Deny rules"]
        BASTION["üîë Bastion Host<br/>‚Ä¢ SSH jump server<br/>‚Ä¢ MFA required<br/>‚Ä¢ Session recording<br/>‚Ä¢ Auto-timeout"]
    end

    subgraph "Identity & Access Management"
        IAM["üë• IAM/RBAC<br/>‚Ä¢ User accounts<br/>‚Ä¢ Service accounts<br/>‚Ä¢ Role-based access<br/>‚Ä¢ Least privilege"]
        MFA["üì± Multi-Factor Auth<br/>‚Ä¢ TOTP/Hardware keys<br/>‚Ä¢ Mandatory for prod<br/>‚Ä¢ API key rotation"]
        SSO["üîê Single Sign-On<br/>‚Ä¢ SAML/OAuth2<br/>‚Ä¢ Centralized auth<br/>‚Ä¢ Session management"]
        SECRETS["üîí Secrets Manager<br/>‚Ä¢ Vault/AWS Secrets<br/>‚Ä¢ Auto-rotation<br/>‚Ä¢ Encryption keys<br/>‚Ä¢ API credentials"]
    end

    subgraph "Application Security"
        subgraph "Container Security"
            SCAN["üîç Image Scanning<br/>‚Ä¢ Vulnerability scan<br/>‚Ä¢ CVE detection<br/>‚Ä¢ Base image updates<br/>‚Ä¢ Trivy/Snyk"]
            SIGN["‚úçÔ∏è Image Signing<br/>‚Ä¢ Cosign/Notary<br/>‚Ä¢ Supply chain<br/>‚Ä¢ Trusted registry"]
            POL["üìú Pod Security<br/>‚Ä¢ Security policies<br/>‚Ä¢ Non-root users<br/>‚Ä¢ Read-only FS<br/>‚Ä¢ Network policies"]
        end

        subgraph "Data Security"
            ENC_REST["üíæ Encryption at Rest<br/>‚Ä¢ Database: AES-256<br/>‚Ä¢ Storage: KMS<br/>‚Ä¢ Backups: Encrypted"]
            ENC_TRANS["üîÑ Encryption in Transit<br/>‚Ä¢ TLS 1.3<br/>‚Ä¢ mTLS for services<br/>‚Ä¢ Kafka SSL<br/>‚Ä¢ VPN tunnels"]
            MASK["üé≠ Data Masking<br/>‚Ä¢ PII redaction<br/>‚Ä¢ Log sanitization<br/>‚Ä¢ Dev data masking"]
        end
    end

    subgraph "Monitoring & Compliance"
        AUDIT["üìù Audit Logging<br/>‚Ä¢ CloudTrail/Stackdriver<br/>‚Ä¢ All API calls<br/>‚Ä¢ User activities<br/>‚Ä¢ Data access logs"]
        SIEM["üîç SIEM<br/>‚Ä¢ Security events<br/>‚Ä¢ Anomaly detection<br/>‚Ä¢ Alert correlation<br/>‚Ä¢ Incident response"]
        COMPLY["‚úÖ Compliance<br/>‚Ä¢ SOC2 Type II<br/>‚Ä¢ GDPR ready<br/>‚Ä¢ Data retention<br/>‚Ä¢ Right to delete"]
        MONITOR["üìä Security Monitoring<br/>‚Ä¢ Failed auth attempts<br/>‚Ä¢ Unusual API calls<br/>‚Ä¢ Data exfiltration<br/>‚Ä¢ Privilege escalation"]
    end

    EXT_USER --> WAF
    EXT_API --> WAF
    EXT_THREAT --> WAF

    WAF --> CDN
    CDN --> LB
    LB --> VPC

    VPC --> SG
    SG --> NACL
    NACL --> BASTION

    BASTION --> IAM
    IAM --> MFA
    MFA --> SSO
    SSO --> SECRETS

    SECRETS --> SCAN
    SCAN --> SIGN
    SIGN --> POL

    POL --> ENC_REST
    ENC_REST --> ENC_TRANS
    ENC_TRANS --> MASK

    MASK --> AUDIT
    AUDIT --> SIEM
    SIEM --> COMPLY
    COMPLY --> MONITOR

    style WAF fill:#ffcdd2
    style VPC fill:#e1bee7
    style IAM fill:#c5cae9
    style ENC_REST fill:#b2dfdb
    style AUDIT fill:#ffe0b2
    </div>

    <div class="mermaid">
graph LR
    subgraph "Access Control Matrix"
        subgraph "Roles"
            R_ADMIN["üëë Admin<br/>Full access"]
            R_DEV["üíª Developer<br/>Read/Write Dev/Stage"]
            R_DATA["üìä Data Analyst<br/>Read-only Prod data"]
            R_OPS["‚öôÔ∏è DevOps<br/>Infrastructure access"]
            R_AUDIT["üìã Auditor<br/>Logs and reports"]
        end

        subgraph "Resources"
            RES_PROD["Production<br/>‚Ä¢ Databases<br/>‚Ä¢ Kafka<br/>‚Ä¢ APIs"]
            RES_STAGE["Staging<br/>‚Ä¢ Test data<br/>‚Ä¢ Pre-prod"]
            RES_DEV["Development<br/>‚Ä¢ Local data<br/>‚Ä¢ Sandbox"]
            RES_INFRA["Infrastructure<br/>‚Ä¢ K8s cluster<br/>‚Ä¢ Cloud resources"]
            RES_LOGS["Monitoring<br/>‚Ä¢ Logs<br/>‚Ä¢ Metrics<br/>‚Ä¢ Alerts"]
        end

        subgraph "Permissions"
            P_FULL["‚úÖ Full Access"]
            P_RW["üìù Read/Write"]
            P_RO["üëÅÔ∏è Read Only"]
            P_EXEC["‚ö° Execute"]
            P_DENY["‚ùå No Access"]
        end
    end

    R_ADMIN --> P_FULL
    P_FULL --> RES_PROD
    P_FULL --> RES_STAGE
    P_FULL --> RES_DEV
    P_FULL --> RES_INFRA
    P_FULL --> RES_LOGS

    R_DEV --> P_RW
    P_RW --> RES_DEV
    P_RW --> RES_STAGE
    R_DEV --> P_RO
    P_RO --> RES_PROD

    R_DATA --> P_RO
    P_RO --> RES_PROD
    P_RO --> RES_LOGS

    R_OPS --> P_FULL
    P_FULL --> RES_INFRA
    R_OPS --> P_EXEC
    P_EXEC --> RES_PROD

    R_AUDIT --> P_RO
    P_RO --> RES_LOGS

    style R_ADMIN fill:#ffcdd2
    style R_DEV fill:#e1bee7
    style R_DATA fill:#c5cae9
    style R_OPS fill:#b2dfdb
    style R_AUDIT fill:#ffe0b2
    </div>

    <div class="description">
        <h2>Security Controls by Component</h2>
        <table>
            <tr>
                <th>Component</th>
                <th>Security Controls</th>
                <th>Risk Level</th>
            </tr>
            <tr class="security-critical">
                <td>API Gateway</td>
                <td>
                    ‚Ä¢ API key authentication<br/>
                    ‚Ä¢ Rate limiting (1000 req/min)<br/>
                    ‚Ä¢ OAuth 2.0 / JWT tokens<br/>
                    ‚Ä¢ Request validation
                </td>
                <td>Critical</td>
            </tr>
            <tr class="security-critical">
                <td>Kafka/Redpanda</td>
                <td>
                    ‚Ä¢ SASL/SCRAM authentication<br/>
                    ‚Ä¢ TLS encryption<br/>
                    ‚Ä¢ ACLs per topic<br/>
                    ‚Ä¢ Network isolation
                </td>
                <td>Critical</td>
            </tr>
            <tr class="security-critical">
                <td>PostgreSQL</td>
                <td>
                    ‚Ä¢ SSL required<br/>
                    ‚Ä¢ Row-level security<br/>
                    ‚Ä¢ Encrypted backups<br/>
                    ‚Ä¢ Connection limits
                </td>
                <td>Critical</td>
            </tr>
            <tr class="security-high">
                <td>Airflow</td>
                <td>
                    ‚Ä¢ LDAP/AD integration<br/>
                    ‚Ä¢ Role-based DAG access<br/>
                    ‚Ä¢ Encrypted connections<br/>
                    ‚Ä¢ Audit logs
                </td>
                <td>High</td>
            </tr>
            <tr class="security-high">
                <td>Containers</td>
                <td>
                    ‚Ä¢ Non-root users<br/>
                    ‚Ä¢ Read-only filesystem<br/>
                    ‚Ä¢ Security scanning<br/>
                    ‚Ä¢ Resource limits
                </td>
                <td>High</td>
            </tr>
            <tr class="security-medium">
                <td>Monitoring</td>
                <td>
                    ‚Ä¢ Read-only access<br/>
                    ‚Ä¢ No PII in logs<br/>
                    ‚Ä¢ Log retention policy<br/>
                    ‚Ä¢ Alert encryption
                </td>
                <td>Medium</td>
            </tr>
        </table>
    </div>

    <div class="mermaid">
flowchart TD
    subgraph "Incident Response Plan"
        DETECT["üö® Detection<br/>‚Ä¢ SIEM alerts<br/>‚Ä¢ Anomaly detection<br/>‚Ä¢ User reports<br/>‚Ä¢ Monitoring"]

        TRIAGE["üìã Triage<br/>‚Ä¢ Severity assessment<br/>‚Ä¢ Impact analysis<br/>‚Ä¢ Resource allocation<br/>‚Ä¢ Stakeholder notify"]

        CONTAIN["üîí Containment<br/>‚Ä¢ Isolate affected systems<br/>‚Ä¢ Preserve evidence<br/>‚Ä¢ Stop data loss<br/>‚Ä¢ Limit spread"]

        ERADICATE["üßπ Eradication<br/>‚Ä¢ Remove threat<br/>‚Ä¢ Patch vulnerabilities<br/>‚Ä¢ Update signatures<br/>‚Ä¢ Clean systems"]

        RECOVER["‚ôªÔ∏è Recovery<br/>‚Ä¢ Restore services<br/>‚Ä¢ Verify integrity<br/>‚Ä¢ Monitor closely<br/>‚Ä¢ User communication"]

        LESSONS["üìö Lessons Learned<br/>‚Ä¢ Post-mortem<br/>‚Ä¢ Update procedures<br/>‚Ä¢ Training needs<br/>‚Ä¢ Preventive measures"]
    end

    DETECT -->|"< 5 min"| TRIAGE
    TRIAGE -->|"< 15 min"| CONTAIN
    CONTAIN -->|"< 1 hour"| ERADICATE
    ERADICATE -->|"< 4 hours"| RECOVER
    RECOVER -->|"< 1 week"| LESSONS

    style DETECT fill:#ffcdd2
    style TRIAGE fill:#ffe0b2
    style CONTAIN fill:#fff9c4
    style ERADICATE fill:#f0f4c3
    style RECOVER fill:#c8e6c9
    style LESSONS fill:#b2dfdb
    </div>

    <div class="description">
        <h2>Security Checklist</h2>
        <table>
            <tr>
                <th>Category</th>
                <th>Item</th>
                <th>Status</th>
            </tr>
            <tr>
                <td rowspan="4">Network</td>
                <td>VPC with private subnets</td>
                <td>‚úÖ Implemented</td>
            </tr>
            <tr>
                <td>Security groups configured</td>
                <td>‚úÖ Implemented</td>
            </tr>
            <tr>
                <td>NACLs for subnet isolation</td>
                <td>‚ö†Ô∏è Partial</td>
            </tr>
            <tr>
                <td>VPN/Private connectivity</td>
                <td>üìã Planned</td>
            </tr>
            <tr>
                <td rowspan="4">Identity</td>
                <td>MFA for all users</td>
                <td>‚úÖ Implemented</td>
            </tr>
            <tr>
                <td>Service accounts with minimal permissions</td>
                <td>‚úÖ Implemented</td>
            </tr>
            <tr>
                <td>Regular key rotation</td>
                <td>‚ö†Ô∏è Partial</td>
            </tr>
            <tr>
                <td>SSO integration</td>
                <td>üìã Planned</td>
            </tr>
            <tr>
                <td rowspan="4">Data</td>
                <td>Encryption at rest</td>
                <td>‚úÖ Implemented</td>
            </tr>
            <tr>
                <td>Encryption in transit</td>
                <td>‚úÖ Implemented</td>
            </tr>
            <tr>
                <td>Data masking/tokenization</td>
                <td>‚ö†Ô∏è Partial</td>
            </tr>
            <tr>
                <td>Backup encryption</td>
                <td>‚úÖ Implemented</td>
            </tr>
            <tr>
                <td rowspan="4">Monitoring</td>
                <td>Centralized logging</td>
                <td>‚úÖ Implemented</td>
            </tr>
            <tr>
                <td>Security event monitoring</td>
                <td>‚ö†Ô∏è Partial</td>
            </tr>
            <tr>
                <td>Vulnerability scanning</td>
                <td>‚úÖ Implemented</td>
            </tr>
            <tr>
                <td>Penetration testing</td>
                <td>üìã Planned</td>
            </tr>
        </table>
    </div>

    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            themeVariables: {
                primaryColor: '#F44336',
                primaryTextColor: '#fff',
                primaryBorderColor: '#D32F2F',
                lineColor: '#333'
            }
        });
    </script>
</body>
</html>
